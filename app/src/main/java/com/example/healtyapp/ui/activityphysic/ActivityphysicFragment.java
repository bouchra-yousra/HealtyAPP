package com.example.healtyapp.ui.activityphysic;import android.animation.Animator;import android.animation.AnimatorListenerAdapter;import android.animation.ObjectAnimator;import android.content.Context;import android.content.Intent;import android.content.SharedPreferences;import android.content.res.Resources;import android.os.Bundle;import android.util.TypedValue;import android.view.LayoutInflater;import android.view.View;import android.view.ViewGroup;import android.widget.AdapterView;import android.widget.Button;import android.widget.LinearLayout;import android.widget.ListView;import android.widget.ProgressBar;import android.widget.RelativeLayout;import android.widget.TextView;import android.widget.Toast;import androidx.annotation.NonNull;import androidx.annotation.Nullable;import androidx.fragment.app.Fragment;import androidx.lifecycle.Observer;import androidx.lifecycle.ViewModelProviders;import com.example.healtyapp.database_item.PhysicalActivity;import com.example.healtyapp.module.ExercicePhysique;import com.example.healtyapp.database_item.ActivityPhUser;import com.example.healtyapp.adapter.ExoPhAdapter;import com.example.healtyapp.vue.center_activities.MainMyMenu;import com.example.healtyapp.R;import com.example.healtyapp.dialogue.TestInflate;import com.google.firebase.database.DataSnapshot;import com.google.firebase.database.DatabaseError;import com.google.firebase.database.DatabaseReference;import com.google.firebase.database.FirebaseDatabase;import com.google.firebase.database.ValueEventListener;import java.util.ArrayList;import java.util.Calendar;public class ActivityphysicFragment extends Fragment implements TestInflate.TestInflateLisnner{    private ActivityphysicViewModel activityphysicViewModel;    public static ProgressBar progressBar_physique;    public static  TextView whatsneedtoburn,whatburned;    public  static  int calories = 0;    ListView listView_all,listView_rec;    ExoPhAdapter exoPhAdapter_all,exoPhAdapter_rec;    Button click;    ArrayList<ExercicePhysique> arrayList= new ArrayList<>();    DatabaseReference databaseReference;    LinearLayout linearLayout;    //manipulate progress    private SharedPreferences share;    private final String SHARE = MainMyMenu.Share;    private static final String PROGRESS_PHYSIQUE = MainMyMenu.PROGRESS_PHYSIQUE;    //today    Calendar calSelected = Calendar.getInstance();    String today = "" + calSelected.get(Calendar.DAY_OF_MONTH)            + (calSelected.get(Calendar.MONTH) + 1)            + calSelected.get(Calendar.YEAR);    public View onCreateView(@NonNull LayoutInflater inflater,                             ViewGroup container, Bundle savedInstanceState) {        activityphysicViewModel =                ViewModelProviders.of(this).get(ActivityphysicViewModel.class);        final View root = inflater.inflate(R.layout.activity_actphysic, container, false);        activityphysicViewModel.getText().observe(getViewLifecycleOwner(), new Observer<String>() {            @Override            public void onChanged(@Nullable String s) {            }        });        share = getActivity().getSharedPreferences(SHARE,getActivity().MODE_PRIVATE);        //progression        progressBar_physique = root.findViewById(R.id.progress_actph);        progressBar_physique.setMax(((int) MainMyMenu.kca) / 3);        progressBar_physique.setProgress(share.getInt(PROGRESS_PHYSIQUE,0));        Toast.makeText(getActivity(),"progress "+share.getInt(PROGRESS_PHYSIQUE,0),Toast.LENGTH_SHORT).show();        //getHistory_all_Progress_physique(progressBar_physique);        whatburned = root.findViewById(R.id.whatburned_actph);        whatburned.setText(String.valueOf(share.getInt(PROGRESS_PHYSIQUE,progressBar_physique.getProgress())));        whatsneedtoburn = root.findViewById(R.id.whatneedactph);        whatsneedtoburn.setText(String.valueOf(progressBar_physique.getMax()));        linearLayout = root.findViewById(R.id.historyph_bt);        listView_all = root.findViewById(R.id.list_actph_all);        exoPhAdapter_all = new ExoPhAdapter(getActivity(),R.layout.itemactivityphysique,MainMyMenu.exercicePhysiqueArrayList);        ViewGroup.LayoutParams layoutParams = listView_all.getLayoutParams();        layoutParams.height = methode((MainMyMenu.exercicePhysiqueArrayList.size()*60)+5,getContext()); //this is in pixels        listView_all.setLayoutParams(layoutParams);        exoPhAdapter_all.notifyDataSetChanged();        listView_all.setAdapter(null);        listView_all.setAdapter(exoPhAdapter_all);        listView_rec = root.findViewById(R.id.list_actph_rec);        click = root.findViewById(R.id.click);        getRecList(5);        //Toast.makeText(this.getContext(), "out", Toast.LENGTH_LONG).show();        exoPhAdapter_rec = new ExoPhAdapter(getActivity(),R.layout.itemactivityphysique,arrayList);        layoutParams = listView_rec.getLayoutParams();        layoutParams.height = methode((arrayList.size()*60)+5,getContext()); //this is in pixels        listView_rec.setLayoutParams(layoutParams);        exoPhAdapter_rec.notifyDataSetChanged();        listView_rec.setAdapter(null);        listView_rec.setAdapter(exoPhAdapter_rec);        final RelativeLayout item =root.findViewById(R.id.item);        click.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View v) {            }        });        animate_progressbar(progressBar_physique);        // creation of the dialogue when we click any item of the listView_all (all the exercises that exist)        listView_all.setOnItemClickListener(new AdapterView.OnItemClickListener() {            @Override            public void onItemClick(AdapterView<?> parent, View view, int position, long id) {                TestInflate testInflate = new TestInflate();                TestInflate.exercicePhysique = (ExercicePhysique) parent.getItemAtPosition(position);                testInflate.show(getActivity().getSupportFragmentManager(), "Test dialog");            }        });        // creation of the dialogue when we click any item of the listView_all (all the exercises that exist)        listView_rec.setOnItemClickListener(new AdapterView.OnItemClickListener() {            @Override            public void onItemClick(AdapterView<?> parent, View view, int position, long id) {                TestInflate testInflate = new TestInflate();                TestInflate.exercicePhysique = (ExercicePhysique) parent.getItemAtPosition(position);                testInflate.show(getActivity().getSupportFragmentManager(), "Test dialog");            }        });        //click historique        linearLayout.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View v) {                getHistory();            }        });        return root;    }    public double HowMuchCaloriesBurnExo(ExercicePhysique exercicePhysique, Double timeInMinute){        /*Consommation en Kcal par minute = (MET*3,5*Poids en kilos)/200Ce qui donne pour une personne de 60 kilos faisant de la marche calme pendant 30 minutes :Consommation en Kcal par minute = (3*3,5*60)/200 = 3,15 Kcal/mnDonc pour 30 minutes = 3,15*30 = 94 kcal pour 30 minutes*/        double MET = exercicePhysique.getMET();        double poids = MainMyMenu.poids;        double KcalPerMin = (MET * 3.5 * poids)/200;        double KcalTotal = KcalPerMin*timeInMinute;        return KcalTotal;    }    //convert dp into pixel    public static int methode(float dp, Context context){        Resources resources = context.getResources();        int i = (int) TypedValue.applyDimension(                TypedValue.COMPLEX_UNIT_DIP,                dp,                resources.getDisplayMetrics()        );        return i;    }    @Override    public void applyTexts(int calories, double time, ExercicePhysique exercicePhysique) {    }    public void getHistory(){        databaseReference = FirebaseDatabase.getInstance().getReference().child("UserActivitys").child(MainMyMenu.user.getIdUser()).child("PH");        HistoryUserPh.activityPhUsers = new ArrayList<>();        databaseReference.addValueEventListener(new ValueEventListener() {            @Override            public void onDataChange(@NonNull DataSnapshot dataSnapshot) {                for(DataSnapshot snapshot : dataSnapshot.getChildren()){                    ActivityPhUser activityPhUser= snapshot.getValue(ActivityPhUser.class);                    HistoryUserPh.activityPhUsers.add(new PhysicalActivity (activityPhUser.getExercicePhysique().getTitle(),activityPhUser.getDuree(),activityPhUser.getCalories_burned()));                }            }            @Override            public void onCancelled(@NonNull DatabaseError databaseError) {            }        });        startActivity(new Intent(getActivity(),HistoryUserPh.class));    }    private void getHistory_all_Progress_physique (final ProgressBar pro2){        DatabaseReference databaseReference = FirebaseDatabase.getInstance().getReference().child("UserActivitys").child(MainMyMenu.user.getIdUser()).child(today);        databaseReference.addValueEventListener(new ValueEventListener() {            @Override            public void onDataChange(@NonNull DataSnapshot dataSnapshot) {                if (dataSnapshot.exists()) {                    int progn = 0;                    if (dataSnapshot.child("Progressions").exists()) {                        if (dataSnapshot.child("Progressions").child("Physique").exists())                            progn = dataSnapshot.child("Progressions").child("Physique").getValue(Integer.class);                    }                    pro2.setProgress(pro2.getProgress() + progn);                    update_progress (pro2.getProgress());                }            }            @Override            public void onCancelled(@NonNull DatabaseError databaseError) {            }        });    }    private void update_progress(int progress) {        SharedPreferences.Editor editor = share.edit();        editor.putInt(PROGRESS_PHYSIQUE, share.getInt(PROGRESS_PHYSIQUE, 0) + progress);        editor.apply();    }    public void getRecList(int size){        if (MainMyMenu.exercicePhysiqueArrayList.size() <size)            size = MainMyMenu.exercicePhysiqueArrayList.size();        for(int i = 0; i<MainMyMenu.exercicePhysiqueArrayList.size(); i++){            for(int j=0;j<MainMyMenu.user.getObjectifs().size();j++){                if(MainMyMenu.exercicePhysiqueArrayList.get(i).getObjectif().equals(MainMyMenu.user.getObjectifs().get(j))){                    arrayList.add(MainMyMenu.exercicePhysiqueArrayList.get(i));                }            }        }    }    //ANIMATION    private void animate_progressbar (final ProgressBar p) {        final ObjectAnimator objectAnimator = ObjectAnimator.ofInt(p,"progress",0,p.getProgress());        objectAnimator.setDuration(1500);        objectAnimator.addListener(new AnimatorListenerAdapter() {            @Override            public void onAnimationCancel(Animator animation) {                super.onAnimationCancel(animation);              //  p.setVisibility(View.GONE);            }        });        objectAnimator.start();    }}